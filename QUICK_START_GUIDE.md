# Quick Start Guide - Image Generation Feature

## Installation & Setup

### 1. Install Required Packages
```bash
pip install google-generativeai pillow
```

### 2. Create Database Migration
```bash
cd /Users/tanmaymaloo/Repository/arduino/audioProcessor
python manage.py makemigrations api
python manage.py migrate
```

### 3. Set Environment Variables
Add to your `.env` file or set in your shell:
```bash
export GOOGLE_API_KEY="your-google-api-key-here"
export ASSEMBLYAI_API_KEY="your-assemblyai-api-key-here"
```

### 4. Verify Setup
```bash
# Check if image directories exist
mkdir -p media/image
mkdir -p media/audio
```

## Quick Test

### Scenario 1: Simple Image Generation Flow
```bash
#!/bin/bash

# 1. Upload an audio file
echo "Uploading audio file..."
RESPONSE=$(curl -s -X POST http://localhost:8000/api/transcribe \
  -F "audio_file=@your_audio.wav")

UUID=$(echo $RESPONSE | jq -r '.uuid')
echo "Transcription UUID: $UUID"

# 2. Wait for transcription to complete
echo "Waiting for transcription..."
sleep 10

# 3. Check status
curl -s http://localhost:8000/api/image-info/$UUID | jq '.'

# 4. Download the image once ready
curl -o generated.png "http://localhost:8000/api/image/$UUID?format=file"
echo "Image saved to generated.png"

# 5. Download raw data
curl -o generated.bin "http://localhost:8000/api/image/$UUID?format=raw"
echo "Raw data saved to generated.bin"
```

### Scenario 2: Direct API Calls
```bash
# Get transcription + image info
curl http://localhost:8000/api/transcribe/550e8400-e29b-41d4-a716-446655440000 | jq '.'

# Get image info
curl http://localhost:8000/api/image-info/550e8400-e29b-41d4-a716-446655440000 | jq '.'

# Download PNG
curl -o my_image.png \
  "http://localhost:8000/api/image/550e8400-e29b-41d4-a716-446655440000"

# Download raw printer data
curl -o printer_data.bin \
  "http://localhost:8000/api/image/550e8400-e29b-41d4-a716-446655440000?format=raw"
```

## What's New

### Files Created
- `api/image_service.py` - New image generation module
- `IMPLEMENTATION_SUMMARY.md` - Feature documentation
- `API_USAGE_GUIDE.md` - API usage examples
- `TECHNICAL_ARCHITECTURE.md` - System architecture details

### Files Modified
- `api/models.py` - Added `image_path` and `image_raw` fields
- `api/transcription_service.py` - Added image generation callback
- `api/views.py` - Added 2 new API endpoints
- `api/urls.py` - Added 2 new routes

### Database Migration Needed
```bash
python manage.py makemigrations api
python manage.py migrate
```

## API Endpoints Reference

| Method | Endpoint | Purpose |
|--------|----------|---------|
| POST | `/api/transcribe` | Upload audio and start transcription |
| GET | `/api/transcribe/<uuid>` | Get transcription status |
| GET | `/api/image/<uuid>` | Retrieve generated image (PNG or raw) |
| GET | `/api/image-info/<uuid>` | Get image generation info |

## Image Format Details

### PNG Format
- Generated by Google Gemini 2.5
- Dimensions: 685 × 913 pixels (3:4 aspect ratio)
- Style: Black line art, cartoon, coloring book
- Perfect for display or web use

### Raw Binary Format
- Width: 48 bytes per row (384 pixels)
- Height: Variable (aspect ratio preserved)
- Dithering: Floyd-Steinberg
- Bit Format: LSB-first, inverted for thermal printers
- Use Case: Direct printer output

## Typical Response Times

| Step | Time |
|------|------|
| Upload audio | < 1 second |
| Transcription | 5-60 seconds (depends on audio length) |
| Image generation | 10-30 seconds |
| **Total** | **15-90 seconds** |

## Common Issues & Solutions

### Issue: "GOOGLE_API_KEY environment variable is not set"
**Solution**: Add to `.env` file or export in terminal
```bash
export GOOGLE_API_KEY="your-key-here"
```

### Issue: "Image not yet generated" (202 response)
**Solution**: Image is still being generated. Wait and retry in a few seconds.

### Issue: "No image data found in API response"
**Solution**: Check Gemini API quota and logs for errors

### Issue: "Image file not found on disk"
**Solution**: Verify `media/image/` directory exists and is writable

### Issue: Database migration error
**Solution**: Run `python manage.py migrate` to apply pending migrations

## Monitoring & Logging

Check Django logs for image generation details:
```bash
# Watch logs in real-time
tail -f logs/django.log | grep -i image

# Check specific UUID
grep "550e8400-e29b-41d4-a716-446655440000" logs/django.log
```

## Next Steps

1. **Test the workflow**: Follow "Quick Test" scenarios above
2. **Integrate into frontend**: Use image endpoints in your UI
3. **Set up monitoring**: Track image generation success rates
4. **Optimize**: Configure caching and CDN for images if needed
5. **Scale**: Consider async job queue for high volume

## Documentation Files

| File | Purpose |
|------|---------|
| `IMPLEMENTATION_SUMMARY.md` | Overview of all changes |
| `API_USAGE_GUIDE.md` | Complete API examples |
| `TECHNICAL_ARCHITECTURE.md` | Deep technical details |
| `QUICK_START_GUIDE.md` | This file |

## Key Features

✅ Automatic image generation after transcription
✅ Multiple output formats (PNG + raw binary)
✅ Background processing (non-blocking)
✅ Database persistence for fast retrieval
✅ Comprehensive error handling
✅ RESTful API design
✅ UUID-based tracking
✅ Printer-optimized raw format

## Support

For issues or questions:
1. Check the documentation files
2. Review Django logs for error details
3. Test with sample audio files
4. Verify API keys are set correctly
5. Check file system permissions
